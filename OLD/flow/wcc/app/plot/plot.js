(function() {
  var ng, plotCtrl;

  ng = angular.module('myApp');

  ng.config(function($stateProvider, navbarProvider) {
    $stateProvider.state('plot', {
      url: '/plot',
      templateUrl: '/plot/plot.html',
      controller: plotCtrl
    });
    return navbarProvider.add('/plot', 'Plot', 30);
  });

  plotCtrl = function($scope, jeebus) {
    var adjust, drivers, fetchPlot, handlePlotData, rowHandler, setPlot, setup, updatePlot;
    drivers = {};
    handlePlotData = function(row, point) {
      var s;
      s = $scope.series[row];
      if (s != null) {
        if (s.values == null) {
          s.values = [];
        }
        return s.values.push([point.Asof, point.Avg]);
      }
    };
    fetchPlot = function(rowIx) {
      var now, readings, row, sensor;
      readings = $scope.readings;
      if (readings.length > rowIx) {
        row = readings[rowIx];
        if ($scope.series == null) {
          $scope.series = [];
        }
        $scope.series[0] = {
          dbkey: "" + row.loc + "/" + row.param,
          label: "" + row.loc + " " + row.param,
          start: 0,
          end: 0,
          values: []
        };
        sensor = "sensor/" + $scope.series[0].dbkey;
        console.log("Fetching plot data for", sensor);
        now = (new Date()).getTime();
        return jeebus.timeRange(sensor, now - 3600 * 1000, now, 20 * 1000, angular.bind(this, handlePlotData, 0)).on('sync', function() {
          return updatePlot(0);
        });
      }
    };
    updatePlot = function(rowIx) {
      var series, sorter;
      series = $scope.series[rowIx];
      console.log("Displaying plot", series.label, "with", series.values.length, "points");
      sorter = function(d) {
        return d[0];
      };
      if ($scope.flotData == null) {
        $scope.flotData = [];
      }
      return $scope.flotData[0] = {
        label: series.label,
        data: _.sortBy(series.values, sorter)
      };
    };
    setPlot = function(rowIx) {
      $scope.plotRow = rowIx;
      if ($scope.flotData == null) {
        $scope.flotData = [];
      }
      $scope.flotOptions = {
        xaxis: {
          mode: "time"
        }
      };
      return fetchPlot(rowIx);
    };
    rowHandler = function(key, row) {
      var id, loc, ms, param, raw, typ, val;
      loc = row.loc, ms = row.ms, val = row.val, typ = row.typ;
      for (param in val) {
        raw = val[param];
        id = "" + key + " - " + param;
        this.set(id, adjust({
          loc: loc,
          param: param,
          raw: raw,
          ms: ms,
          typ: typ
        }));
        if (this.keys[id] === 0) {
          fetchPlot(0);
        }
        console.log("set", id, "to", adjust({
          loc: loc,
          param: param,
          raw: raw,
          ms: ms,
          typ: typ
        }));
      }
      return null;
    };
    adjust = function(row) {
      var info;
      row.value = row.raw;
      info = drivers.get("" + row.typ + "/" + row.param);
      if (info != null) {
        row.param = info.name;
        row.unit = info.unit;
        if (info.factor) {
          row.value *= info.factor;
        }
        if (info.scale < 0) {
          row.value *= Math.pow(10, -info.scale);
        } else if (info.scale >= 0) {
          row.value /= Math.pow(10, info.scale);
          row.value = row.value.toFixed(info.scale);
        }
      }
      return row;
    };
    setup = function() {
      return drivers = jeebus.attach('driver').on('sync', function() {
        return jeebus.attach('reading', rowHandler).on('init', function() {
          $scope.readings = this.rows;
          return setPlot(0);
        });
      });
    };
    if ($scope.serverPlot === 'connected') {
      setup();
    }
    return $scope.$on('ws-open', setup);
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicGxvdC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxNQUFBLFlBQUE7O0FBQUEsRUFBQSxFQUFBLEdBQUssT0FBTyxDQUFDLE1BQVIsQ0FBZSxPQUFmLENBQUwsQ0FBQTs7QUFBQSxFQUVBLEVBQUUsQ0FBQyxNQUFILENBQVUsU0FBQyxjQUFELEVBQWlCLGNBQWpCLEdBQUE7QUFDUixJQUFBLGNBQWMsQ0FBQyxLQUFmLENBQXFCLE1BQXJCLEVBQ0U7QUFBQSxNQUFBLEdBQUEsRUFBSyxPQUFMO0FBQUEsTUFDQSxXQUFBLEVBQWEsaUJBRGI7QUFBQSxNQUVBLFVBQUEsRUFBWSxRQUZaO0tBREYsQ0FBQSxDQUFBO1dBSUEsY0FBYyxDQUFDLEdBQWYsQ0FBbUIsT0FBbkIsRUFBNEIsTUFBNUIsRUFBb0MsRUFBcEMsRUFMUTtFQUFBLENBQVYsQ0FGQSxDQUFBOztBQUFBLEVBU0EsUUFBQSxHQUFXLFNBQUMsTUFBRCxFQUFTLE1BQVQsR0FBQTtBQUNULFFBQUEsa0ZBQUE7QUFBQSxJQUFBLE9BQUEsR0FBVSxFQUFWLENBQUE7QUFBQSxJQUdBLGNBQUEsR0FBaUIsU0FBQyxHQUFELEVBQU0sS0FBTixHQUFBO0FBRWYsVUFBQSxDQUFBO0FBQUEsTUFBQSxDQUFBLEdBQUksTUFBTSxDQUFDLE1BQU8sQ0FBQSxHQUFBLENBQWxCLENBQUE7QUFDQSxNQUFBLElBQUcsU0FBSDs7VUFDRSxDQUFDLENBQUMsU0FBVTtTQUFaO2VBQ0EsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFULENBQWMsQ0FBQyxLQUFLLENBQUMsSUFBUCxFQUFhLEtBQUssQ0FBQyxHQUFuQixDQUFkLEVBRkY7T0FIZTtJQUFBLENBSGpCLENBQUE7QUFBQSxJQVlBLFNBQUEsR0FBWSxTQUFDLEtBQUQsR0FBQTtBQUVWLFVBQUEsMEJBQUE7QUFBQSxNQUFBLFFBQUEsR0FBVyxNQUFNLENBQUMsUUFBbEIsQ0FBQTtBQUNBLE1BQUEs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IjpbIm5nID0gYW5ndWxhci5tb2R1bGUgJ215QXBwJ1xuXG5uZy5jb25maWcgKCRzdGF0ZVByb3ZpZGVyLCBuYXZiYXJQcm92aWRlcikgLT5cbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUgJ3Bsb3QnLFxuICAgIHVybDogJy9wbG90J1xuICAgIHRlbXBsYXRlVXJsOiAnL3Bsb3QvcGxvdC5odG1sJ1xuICAgIGNvbnRyb2xsZXI6IHBsb3RDdHJsXG4gIG5hdmJhclByb3ZpZGVyLmFkZCAnL3Bsb3QnLCAnUGxvdCcsIDMwXG5cbnBsb3RDdHJsID0gKCRzY29wZSwgamVlYnVzKSAtPlxuICBkcml2ZXJzID0ge31cblxuICAjIGhhbmRsZSBpbmNvbWluZyBkYXRhIGZvciBhIHBsb3RcbiAgaGFuZGxlUGxvdERhdGEgPSAocm93LCBwb2ludCkgLT5cbiAgICAjY29uc29sZS5sb2cgXCJQbG90SGFuZGxlcjpcIiwgYXJndW1lbnRzXG4gICAgcyA9ICRzY29wZS5zZXJpZXNbcm93XVxuICAgIGlmIHM/XG4gICAgICBzLnZhbHVlcyA/PSBbXVxuICAgICAgcy52YWx1ZXMucHVzaChbcG9pbnQuQXNvZiwgcG9pbnQuQXZnXSlcbiAgICAjY29uc29sZS5sb2cgXCJTbyBmYXI6XCIsICRzY29wZS5zZXJpZXNbcm93XVxuXG4gICMgcmVxdWVzdCBkYXRhIGZvciBhIHBsb3RcbiAgZmV0Y2hQbG90ID0gKHJvd0l4KSAtPlxuICAgICMgaWYgd2UgaGF2ZSBpbmZvIG9uIHRoYXQgcmVhZGluZywgdGhlbiBhY3R1YWxseSBmZXRjaCB0aGUgc2Vuc29yIGRhdGFcbiAgICByZWFkaW5ncyA9ICRzY29wZS5yZWFkaW5nc1xuICAgIGlmIHJlYWRpbmdzLmxlbmd0aCA+IHJvd0l4XG4gICAgICByb3cgPSByZWFkaW5nc1tyb3dJeF1cbiAgICAgICRzY29wZS5zZXJpZXMgPz0gW11cbiAgICAgICRzY29wZS5zZXJpZXNbMF0gPSB7XG4gICAgICAgIGRia2V5OiBcIiN7cm93LmxvY30vI3tyb3cucGFyYW19XCJcbiAgICAgICAgbGFiZWw6IFwiI3tyb3cubG9jfSAje3Jvdy5wYXJhbX1cIlxuICAgICAgICBzdGFydDogMFxuICAgICAgICBlbmQ6IDBcbiAgICAgICAgdmFsdWVzOiBbXVxuICAgICAgfVxuICAgICAgc2Vuc29yID0gXCJzZW5zb3IvI3skc2NvcGUuc2VyaWVzWzBdLmRia2V5fVwiXG4gICAgICBjb25zb2xlLmxvZyBcIkZldGNoaW5nIHBsb3QgZGF0YSBmb3JcIiwgc2Vuc29yXG4gICAgICBub3cgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpXG4gICAgICBqZWVidXMudGltZVJhbmdlIHNlbnNvciwgbm93LTM2MDAqMTAwMCwgbm93LCAyMCoxMDAwLCBhbmd1bGFyLmJpbmQodGhpcywgaGFuZGxlUGxvdERhdGEsIDApXG4gICAgICAgIC5vbiAnc3luYycsIC0+XG4gICAgICAgICAgdXBkYXRlUGxvdCgwKVxuXG4gIHVwZGF0ZVBsb3QgPSAocm93SXgpIC0+XG4gICAgc2VyaWVzID0gJHNjb3BlLnNlcmllc1tyb3dJeF1cbiAgICBjb25zb2xlLmxvZyBcIkRpc3BsYXlpbmcgcGxvdFwiLCBzZXJpZXMubGFiZWwsIFwid2l0aFwiLCBzZXJpZXMudmFsdWVzLmxlbmd0aCwgXCJwb2ludHNcIlxuICAgIHNvcnRlciA9IChkKSAtPiBkWzBdXG4gICAgJHNjb3BlLmZsb3REYXRhID89IFtdXG4gICAgJHNjb3BlLmZsb3REYXRhWzBdID0ge1xuICAgICAgICBsYWJlbDogc2VyaWVzLmxhYmVsXG4gICAgICAgIGRhdGE6IF8uc29ydEJ5KHNlcmllcy52YWx1ZXMsIHNvcnRlcilcbiAgICAgIH1cblxuXG4gICMgc2V0IHdoaWNoIHJlYWRpbmdzIHJvdyB3ZSdyZSBwbG90dGluZ1xuICBzZXRQbG90ID0gKHJvd0l4KSAtPlxuICAgICRzY29wZS5wbG90Um93ID0gcm93SXhcbiAgICAkc2NvcGUuZmxvdERhdGEgPz0gW11cbiAgICAkc2NvcGUuZmxvdE9wdGlvbnMgPSB7XG4gICAgICB4YXhpczoge1xuICAgICAgICBtb2RlOiBcInRpbWVcIlxuICAgICAgfVxuICAgIH1cbiAgICBmZXRjaFBsb3Qocm93SXgpXG5cbiAgcm93SGFuZGxlciA9IChrZXksIHJvdykgLT5cbiAgICAjIGxvYzogLi4uIHZhbDogW2MxOjEyLGMyOjM0LC4uLl1cbiAgICB7bG9jLG1zLHZhbCx0eXB9ID0gcm93XG4gICAgZm9yIHBhcmFtLCByYXcgb2YgdmFsXG4gICAgICBpZCA9IFwiI3trZXl9IC0gI3twYXJhbX1cIiAjIGRldmljZSBpZFxuICAgICAgQHNldCBpZCwgYWRqdXN0IHtsb2MscGFyYW0scmF3LG1zLHR5cH1cbiAgICAgIGlmIEBrZXlzW2lkXSA9PSAwXG4gICAgICAgIGZldGNoUGxvdCgwKVxuICAgICAgY29uc29sZS5sb2cgXCJzZXRcIiwgaWQsIFwidG9cIiwgYWRqdXN0IHtsb2MscGFyYW0scmF3LG1zLHR5cH1cbiAgICAjY29uc29sZS5sb2cgXCJyaCByZWFkaW5ncz1cIiwgJHNjb3BlLnJlYWRpbmdzXG4gICAgI2NvbnNvbGUubG9nIFwicmggc2VyaWVzPVwiLCAkc2NvcGUuc2VyaWVzXG4gICAgI2NvbnNvbGUubG9nIFwia2V5cz1cIiwgQGtleXNcbiAgICAjY29uc29sZS5sb2cgXCJyb3dzPVwiLCBAcm93c1xuICAgIG51bGxcblxuICBhZGp1c3QgPSAocm93KSAtPlxuICAgIHJvdy52YWx1ZSA9IHJvdy5yYXdcbiAgICBpbmZvID0gZHJpdmVycy5nZXQgXCIje3Jvdy50eXB9LyN7cm93LnBhcmFtfVwiXG4gICAgaWYgaW5mbz9cbiAgICAgIHJvdy5wYXJhbSA9IGluZm8ubmFtZVxuICAgICAgcm93LnVuaXQgPSBpbmZvLnVuaXRcbiAgICAgICMgYXBwbHkgc29tZSBzY2FsaW5nIGFuZCBmb3JtYXR0aW5nXG4gICAgICBpZiBpbmZvLmZhY3RvclxuICAgICAgICByb3cudmFsdWUgKj0gaW5mby5mYWN0b3JcbiAgICAgIGlmIGluZm8uc2NhbGUgPCAwXG4gICAgICAgIHJvdy52YWx1ZSAqPSBNYXRoLnBvdyAxMCwgLWluZm8uc2NhbGVcbiAgICAgIGVsc2UgaWYgaW5mby5zY2FsZSA+PSAwXG4gICAgICAgIHJvdy52YWx1ZSAvPSBNYXRoLnBvdyAxMCwgaW5mby5zY2FsZVxuICAgICAgICByb3cudmFsdWUgPSByb3cudmFsdWUudG9GaXhlZCBpbmZvLnNjYWxlXG4gICAgcm93XG5cbiAgc2V0dXAgPSAtPlxuICAgIGRyaXZlcnMgPSBqZWVidXMuYXR0YWNoICdkcml2ZXInXG4gICAgICAub24gJ3N5bmMnLCAtPlxuICAgICAgICBqZWVidXMuYXR0YWNoICdyZWFkaW5nJywgcm93SGFuZGxlclxuICAgICAgICAgIC5vbiAnaW5pdCcsIC0+XG4gICAgICAgICAgICAkc2NvcGUucmVhZGluZ3MgPSBAcm93c1xuICAgICAgICAgICAgc2V0UGxvdCgwKVxuICAgICAgXG4gIHNldHVwKCkgIGlmICRzY29wZS5zZXJ2ZXJQbG90IGlzICdjb25uZWN0ZWQnXG4gICRzY29wZS4kb24gJ3dzLW9wZW4nLCBzZXR1cFxuIl19
