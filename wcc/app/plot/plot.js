(function() {
  var ng, plotCtrl;

  ng = angular.module('myApp');

  ng.config(function($stateProvider, navbarProvider) {
    $stateProvider.state('plot', {
      url: '/plot',
      templateUrl: '/plot/plot.html',
      controller: plotCtrl
    });
    return navbarProvider.add('/plot', 'Plot', 30);
  });

  plotCtrl = function($scope, jeebus) {
    var adjust, drivers, fetchPlot, handlePlotData, rowHandler, setPlot, setup, updatePlot;
    drivers = {};
    handlePlotData = function(row, key, value) {
      var s, time;
      s = $scope.series[row];
      if (s != null) {
        if (s.values == null) {
          s.values = [];
        }
        time = parseFloat(key);
        return s.values.push([time, value]);
      }
    };
    fetchPlot = function(rowIx) {
      var now, readings, row, sensor;
      readings = $scope.readings;
      if (readings.length > rowIx) {
        row = readings[rowIx];
        if ($scope.series == null) {
          $scope.series = [];
        }
        $scope.series[0] = {
          dbkey: "" + row.loc + "/" + row.param,
          label: "" + row.loc + " " + row.param,
          start: 0,
          end: 0,
          values: []
        };
        sensor = "sensor/" + $scope.series[0].dbkey;
        console.log("Fetching plot data for", sensor);
        now = (new Date()).getTime();
        return jeebus.timeRange(sensor, now - 3600 * 1000, now, 150, angular.bind(this, handlePlotData, 0)).on('sync', function() {
          return updatePlot(0);
        });
      }
    };
    updatePlot = function(rowIx) {
      var series, sorter;
      series = $scope.series[rowIx];
      console.log("Displaying plot", series.label, "with", series.values.length, "points");
      sorter = function(d) {
        return d[0];
      };
      if ($scope.flotData == null) {
        $scope.flotData = [];
      }
      return $scope.flotData[0] = {
        label: series.label,
        data: _.sortBy(series.values, sorter)
      };
    };
    setPlot = function(rowIx) {
      $scope.plotRow = rowIx;
      if ($scope.flotData == null) {
        $scope.flotData = [];
      }
      $scope.flotOptions = {
        xaxis: {
          mode: "time"
        }
      };
      return fetchPlot(rowIx);
    };
    rowHandler = function(key, row) {
      var id, loc, ms, param, raw, typ, val;
      loc = row.loc, ms = row.ms, val = row.val, typ = row.typ;
      for (param in val) {
        raw = val[param];
        id = "" + key + " - " + param;
        this.set(id, adjust({
          loc: loc,
          param: param,
          raw: raw,
          ms: ms,
          typ: typ
        }));
        if (this.keys[id] === 0) {
          fetchPlot(0);
        }
        console.log("set", id, "to", adjust({
          loc: loc,
          param: param,
          raw: raw,
          ms: ms,
          typ: typ
        }));
      }
      return null;
    };
    adjust = function(row) {
      var info;
      row.value = row.raw;
      info = drivers.get("" + row.typ + "/" + row.param);
      if (info != null) {
        row.param = info.name;
        row.unit = info.unit;
        if (info.factor) {
          row.value *= info.factor;
        }
        if (info.scale < 0) {
          row.value *= Math.pow(10, -info.scale);
        } else if (info.scale >= 0) {
          row.value /= Math.pow(10, info.scale);
          row.value = row.value.toFixed(info.scale);
        }
      }
      return row;
    };
    setup = function() {
      return drivers = jeebus.attach('driver').on('sync', function() {
        return jeebus.attach('reading', rowHandler).on('init', function() {
          $scope.readings = this.rows;
          return setPlot(0);
        });
      });
    };
    if ($scope.serverPlot === 'connected') {
      setup();
    }
    return $scope.$on('ws-open', setup);
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicGxvdC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxNQUFBLFlBQUE7O0FBQUEsRUFBQSxFQUFBLEdBQUssT0FBTyxDQUFDLE1BQVIsQ0FBZSxPQUFmLENBQUwsQ0FBQTs7QUFBQSxFQUVBLEVBQUUsQ0FBQyxNQUFILENBQVUsU0FBQyxjQUFELEVBQWlCLGNBQWpCLEdBQUE7QUFDUixJQUFBLGNBQWMsQ0FBQyxLQUFmLENBQXFCLE1BQXJCLEVBQ0U7QUFBQSxNQUFBLEdBQUEsRUFBSyxPQUFMO0FBQUEsTUFDQSxXQUFBLEVBQWEsaUJBRGI7QUFBQSxNQUVBLFVBQUEsRUFBWSxRQUZaO0tBREYsQ0FBQSxDQUFBO1dBSUEsY0FBYyxDQUFDLEdBQWYsQ0FBbUIsT0FBbkIsRUFBNEIsTUFBNUIsRUFBb0MsRUFBcEMsRUFMUTtFQUFBLENBQVYsQ0FGQSxDQUFBOztBQUFBLEVBU0EsUUFBQSxHQUFXLFNBQUMsTUFBRCxFQUFTLE1BQVQsR0FBQTtBQUNULFFBQUEsa0ZBQUE7QUFBQSxJQUFBLE9BQUEsR0FBVSxFQUFWLENBQUE7QUFBQSxJQUdBLGNBQUEsR0FBaUIsU0FBQyxHQUFELEVBQU0sR0FBTixFQUFXLEtBQVgsR0FBQTtBQUVmLFVBQUEsT0FBQTtBQUFBLE1BQUEsQ0FBQSxHQUFJLE1BQU0sQ0FBQyxNQUFPLENBQUEsR0FBQSxDQUFsQixDQUFBO0FBQ0EsTUFBQSxJQUFHLFNBQUg7O1VBQ0UsQ0FBQyxDQUFDLFNBQVU7U0FBWjtBQUFBLFFBQ0EsSUFBQSxHQUFPLFVBQUEsQ0FBVyxHQUFYLENBRFAsQ0FBQTtlQUVBLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBVCxDQUFjLENBQUMsSUFBRCxFQUFPLEtBQVAsQ0FBZCxFQUhGO09BSGU7SUFBQSxDQUhqQixDQUFBO0FBQUEsSUFhQSxTQUFBLEdBQVksU0FBQyxLQUFELEdBQUE7QUFFVixVQUFBLDBCQUFBO0FBQUEsTUFBQSxRQUFBLEdB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QUE7QUFBQSIsInNvdXJjZXNDb250ZW50IjpbIm5nID0gYW5ndWxhci5tb2R1bGUgJ215QXBwJ1xuXG5uZy5jb25maWcgKCRzdGF0ZVByb3ZpZGVyLCBuYXZiYXJQcm92aWRlcikgLT5cbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUgJ3Bsb3QnLFxuICAgIHVybDogJy9wbG90J1xuICAgIHRlbXBsYXRlVXJsOiAnL3Bsb3QvcGxvdC5odG1sJ1xuICAgIGNvbnRyb2xsZXI6IHBsb3RDdHJsXG4gIG5hdmJhclByb3ZpZGVyLmFkZCAnL3Bsb3QnLCAnUGxvdCcsIDMwXG5cbnBsb3RDdHJsID0gKCRzY29wZSwgamVlYnVzKSAtPlxuICBkcml2ZXJzID0ge31cblxuICAjIGhhbmRsZSBpbmNvbWluZyBkYXRhIGZvciBhIHBsb3RcbiAgaGFuZGxlUGxvdERhdGEgPSAocm93LCBrZXksIHZhbHVlKSAtPlxuICAgICNjb25zb2xlLmxvZyBcIlBsb3RIYW5kbGVyOlwiLCBhcmd1bWVudHNcbiAgICBzID0gJHNjb3BlLnNlcmllc1tyb3ddXG4gICAgaWYgcz9cbiAgICAgIHMudmFsdWVzID89IFtdXG4gICAgICB0aW1lID0gcGFyc2VGbG9hdChrZXkpXG4gICAgICBzLnZhbHVlcy5wdXNoKFt0aW1lLCB2YWx1ZV0pXG4gICAgI2NvbnNvbGUubG9nIFwiU28gZmFyOlwiLCAkc2NvcGUuc2VyaWVzW3Jvd11cblxuICAjIHJlcXVlc3QgZGF0YSBmb3IgYSBwbG90XG4gIGZldGNoUGxvdCA9IChyb3dJeCkgLT5cbiAgICAjIGlmIHdlIGhhdmUgaW5mbyBvbiB0aGF0IHJlYWRpbmcsIHRoZW4gYWN0dWFsbHkgZmV0Y2ggdGhlIHNlbnNvciBkYXRhXG4gICAgcmVhZGluZ3MgPSAkc2NvcGUucmVhZGluZ3NcbiAgICBpZiByZWFkaW5ncy5sZW5ndGggPiByb3dJeFxuICAgICAgcm93ID0gcmVhZGluZ3Nbcm93SXhdXG4gICAgICAkc2NvcGUuc2VyaWVzID89IFtdXG4gICAgICAkc2NvcGUuc2VyaWVzWzBdID0ge1xuICAgICAgICBkYmtleTogXCIje3Jvdy5sb2N9LyN7cm93LnBhcmFtfVwiXG4gICAgICAgIGxhYmVsOiBcIiN7cm93LmxvY30gI3tyb3cucGFyYW19XCJcbiAgICAgICAgc3RhcnQ6IDBcbiAgICAgICAgZW5kOiAwXG4gICAgICAgIHZhbHVlczogW11cbiAgICAgIH1cbiAgICAgIHNlbnNvciA9IFwic2Vuc29yLyN7JHNjb3BlLnNlcmllc1swXS5kYmtleX1cIlxuICAgICAgY29uc29sZS5sb2cgXCJGZXRjaGluZyBwbG90IGRhdGEgZm9yXCIsIHNlbnNvclxuICAgICAgbm93ID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKVxuICAgICAgamVlYnVzLnRpbWVSYW5nZSBzZW5zb3IsIG5vdy0zNjAwKjEwMDAsIG5vdywgMTUwLCBhbmd1bGFyLmJpbmQodGhpcywgaGFuZGxlUGxvdERhdGEsIDApXG4gICAgICAgIC5vbiAnc3luYycsIC0+XG4gICAgICAgICAgdXBkYXRlUGxvdCgwKVxuXG4gIHVwZGF0ZVBsb3QgPSAocm93SXgpIC0+XG4gICAgc2VyaWVzID0gJHNjb3BlLnNlcmllc1tyb3dJeF1cbiAgICBjb25zb2xlLmxvZyBcIkRpc3BsYXlpbmcgcGxvdFwiLCBzZXJpZXMubGFiZWwsIFwid2l0aFwiLCBzZXJpZXMudmFsdWVzLmxlbmd0aCwgXCJwb2ludHNcIlxuICAgIHNvcnRlciA9IChkKSAtPiBkWzBdXG4gICAgJHNjb3BlLmZsb3REYXRhID89IFtdXG4gICAgJHNjb3BlLmZsb3REYXRhWzBdID0ge1xuICAgICAgICBsYWJlbDogc2VyaWVzLmxhYmVsXG4gICAgICAgIGRhdGE6IF8uc29ydEJ5KHNlcmllcy52YWx1ZXMsIHNvcnRlcilcbiAgICAgIH1cblxuXG4gICMgc2V0IHdoaWNoIHJlYWRpbmdzIHJvdyB3ZSdyZSBwbG90dGluZ1xuICBzZXRQbG90ID0gKHJvd0l4KSAtPlxuICAgICRzY29wZS5wbG90Um93ID0gcm93SXhcbiAgICAkc2NvcGUuZmxvdERhdGEgPz0gW11cbiAgICAkc2NvcGUuZmxvdE9wdGlvbnMgPSB7XG4gICAgICB4YXhpczoge1xuICAgICAgICBtb2RlOiBcInRpbWVcIlxuICAgICAgfVxuICAgIH1cbiAgICBmZXRjaFBsb3Qocm93SXgpXG5cbiAgcm93SGFuZGxlciA9IChrZXksIHJvdykgLT5cbiAgICAjIGxvYzogLi4uIHZhbDogW2MxOjEyLGMyOjM0LC4uLl1cbiAgICB7bG9jLG1zLHZhbCx0eXB9ID0gcm93XG4gICAgZm9yIHBhcmFtLCByYXcgb2YgdmFsXG4gICAgICBpZCA9IFwiI3trZXl9IC0gI3twYXJhbX1cIiAjIGRldmljZSBpZFxuICAgICAgQHNldCBpZCwgYWRqdXN0IHtsb2MscGFyYW0scmF3LG1zLHR5cH1cbiAgICAgIGlmIEBrZXlzW2lkXSA9PSAwXG4gICAgICAgIGZldGNoUGxvdCgwKVxuICAgICAgY29uc29sZS5sb2cgXCJzZXRcIiwgaWQsIFwidG9cIiwgYWRqdXN0IHtsb2MscGFyYW0scmF3LG1zLHR5cH1cbiAgICAjY29uc29sZS5sb2cgXCJyaCByZWFkaW5ncz1cIiwgJHNjb3BlLnJlYWRpbmdzXG4gICAgI2NvbnNvbGUubG9nIFwicmggc2VyaWVzPVwiLCAkc2NvcGUuc2VyaWVzXG4gICAgI2NvbnNvbGUubG9nIFwia2V5cz1cIiwgQGtleXNcbiAgICAjY29uc29sZS5sb2cgXCJyb3dzPVwiLCBAcm93c1xuICAgIG51bGxcblxuICBhZGp1c3QgPSAocm93KSAtPlxuICAgIHJvdy52YWx1ZSA9IHJvdy5yYXdcbiAgICBpbmZvID0gZHJpdmVycy5nZXQgXCIje3Jvdy50eXB9LyN7cm93LnBhcmFtfVwiXG4gICAgaWYgaW5mbz9cbiAgICAgIHJvdy5wYXJhbSA9IGluZm8ubmFtZVxuICAgICAgcm93LnVuaXQgPSBpbmZvLnVuaXRcbiAgICAgICMgYXBwbHkgc29tZSBzY2FsaW5nIGFuZCBmb3JtYXR0aW5nXG4gICAgICBpZiBpbmZvLmZhY3RvclxuICAgICAgICByb3cudmFsdWUgKj0gaW5mby5mYWN0b3JcbiAgICAgIGlmIGluZm8uc2NhbGUgPCAwXG4gICAgICAgIHJvdy52YWx1ZSAqPSBNYXRoLnBvdyAxMCwgLWluZm8uc2NhbGVcbiAgICAgIGVsc2UgaWYgaW5mby5zY2FsZSA+PSAwXG4gICAgICAgIHJvdy52YWx1ZSAvPSBNYXRoLnBvdyAxMCwgaW5mby5zY2FsZVxuICAgICAgICByb3cudmFsdWUgPSByb3cudmFsdWUudG9GaXhlZCBpbmZvLnNjYWxlXG4gICAgcm93XG5cbiAgc2V0dXAgPSAtPlxuICAgIGRyaXZlcnMgPSBqZWVidXMuYXR0YWNoICdkcml2ZXInXG4gICAgICAub24gJ3N5bmMnLCAtPlxuICAgICAgICBqZWVidXMuYXR0YWNoICdyZWFkaW5nJywgcm93SGFuZGxlclxuICAgICAgICAgIC5vbiAnaW5pdCcsIC0+XG4gICAgICAgICAgICAkc2NvcGUucmVhZGluZ3MgPSBAcm93c1xuICAgICAgICAgICAgc2V0UGxvdCgwKVxuICAgICAgXG4gIHNldHVwKCkgIGlmICRzY29wZS5zZXJ2ZXJQbG90IGlzICdjb25uZWN0ZWQnXG4gICRzY29wZS4kb24gJ3dzLW9wZW4nLCBzZXR1cFxuIl19
